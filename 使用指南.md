# iCloud 隐藏邮件地址生成器 - 使用指南

## [目录]

1. [快速开始](#快速开始)
2. [获取认证信息](#获取认证信息)
3. [配置文件说明](#配置文件说明)
4. [运行程序](#运行程序)
5. [常见问题](#常见问题)

---

## [快速开始]

### 第一步：编译程序

```bash
go build -o icloud-hme-generator main.go
```

编译成功后会生成 `icloud-hme-generator` 可执行文件。

### 第二步：配置认证信息

编辑 `config.json` 文件，填入你的认证信息（详见下方说明）。

### 第三步：运行程序

```bash
./icloud-hme-generator
```

---

## [获取认证信息]

### 方法一：使用浏览器开发者工具（推荐）

#### 1. 打开 iCloud 网站

- 访问 https://www.icloud.com
- 登录你的 Apple ID

#### 2. 打开开发者工具

- **Chrome/Edge**: 按 `F12` 或 `Cmd+Option+I` (Mac)
- **Firefox**: 按 `F12` 或 `Cmd+Option+I` (Mac)
- **Safari**: 先在设置中启用开发者菜单，然后按 `Cmd+Option+I`

#### 3. 切换到 Network（网络）标签

- 点击开发者工具顶部的 "Network" 或"网络"标签
- 确保录制功能已开启（红色圆点）

#### 4. 访问隐藏邮件功能

- 在 iCloud 界面中，点击"账户设置"
- 找到"隐藏我的邮件"功能
- 手动生成一个测试邮箱地址

#### 5. 找到 API 请求

- 在网络请求列表中，找到名为 `generate` 的请求
- 点击该请求查看详情

#### 6. 复制必要信息

**从 URL 中复制：**
```
https://pXXX-maildomainws.icloud.com/v1/hme/generate?clientBuildNumber=XXXX_BUILD&clientMasteringNumber=XXXX_BUILD&clientId=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&dsid=YOUR_DSID_HERE
```

需要复制的参数：
- `clientId`: 例如 `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`
- `dsid`: 例如 `YOUR_DSID_HERE`

**从请求头中复制：**
- 找到 `Cookie` 字段
- 复制完整的 Cookie 字符串

#### 7. 填入配置文件

将复制的信息填入 `config.json`：

```json
{
  "client_id": "你复制的clientId",
  "dsid": "你复制的dsid",
  "headers": {
    "Cookie": "你复制的完整Cookie字符串"
  }
}
```

### 方法二：使用 Cookie 导出工具

#### 1. 安装浏览器扩展

推荐的扩展：
- **Chrome**: [Cookie-Editor](https://chrome.google.com/webstore/detail/cookie-editor/)
- **Firefox**: [Cookie-Editor](https://addons.mozilla.org/firefox/addon/cookie-editor/)

#### 2. 导出 Cookie

1. 访问 https://www.icloud.com 并登录
2. 点击浏览器工具栏中的 Cookie-Editor 图标
3. 点击"Export"导出所有 Cookie
4. 选择"Netscape"格式（与项目中的 cookies.txt 格式相同）

#### 3. 转换为 Cookie 字符串

使用以下命令将 cookies.txt 转换为 Cookie 字符串：

```bash
cat cookies.txt | grep -v "^#" | awk '{printf "%s=%s; ", $6, $7}' | sed 's/; $//'
```

---

## [配置文件说明]

### 完整配置示例

```json
{
  "base_url": "https://pXXX-maildomainws.icloud.com/v1/hme/generate",
  "client_build_number": "XXXX_BUILD_NUMBER",
  "client_mastering_number": "XXXX_BUILD_NUMBER",
  "client_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "dsid": "YOUR_DSID_HERE",
  "headers": {
    "Accept": "*/*",
    "Accept-Encoding": "gzip, deflate, br, zstd",
    "Accept-Language": "en-US,en;q=0.9",
    "Connection": "keep-alive",
    "Content-Type": "text/plain",
    "Origin": "https://www.icloud.com",
    "Referer": "https://www.icloud.com/",
    "Sec-Fetch-Dest": "empty",
    "Sec-Fetch-Mode": "cors",
    "Sec-Fetch-Site": "same-site",
    "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36",
    "sec-ch-ua": "\"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"138\", \"Google Chrome\";v=\"138\"",
    "sec-ch-ua-mobile": "?0",
    "sec-ch-ua-platform": "\"macOS\"",
    "Cookie": "你的Cookie字符串"
  },
  "lang_code": "en-us",
  "count": 5,
  "delay_seconds": 2,
  "output_file": "generated_emails.txt"
}
```

### 配置项详解

| 配置项 | 必填 | 说明 | 示例值 |
|--------|------|------|--------|
| `base_url` | ✅ | API 端点地址 | `https://pXXX-maildomainws.icloud.com/v1/hme/generate` |
| `client_build_number` | ✅ | 客户端构建号 | `XXXX_BUILD_NUMBER` |
| `client_mastering_number` | ✅ | 客户端主版本号 | `XXXX_BUILD_NUMBER` |
| `client_id` | ✅ | 客户端唯一标识（从浏览器获取） | `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` |
| `dsid` | ✅ | 用户 DSID（从浏览器获取） | `YOUR_DSID_HERE` |
| `headers.Cookie` | ✅ | 认证 Cookie（从浏览器获取） | 完整的 Cookie 字符串 |
| `lang_code` | ❌ | 语言代码 | `en-us` 或 `zh-cn` |
| `count` | ❌ | 生成邮箱数量 | `5`（建议不超过20） |
| `delay_seconds` | ❌ | 每次请求间隔（秒） | `2`（建议2-5秒） |
| `output_file` | ❌ | 输出文件路径 | `generated_emails.txt` |

### 需要修改的配置项

通常只需要修改以下三项：

1. **`client_id`**: 从浏览器 URL 中获取
2. **`dsid`**: 从浏览器 URL 中获取
3. **`headers.Cookie`**: 从浏览器请求头中获取

其他配置项可以保持默认值。

---

## [运行程序]

### 基本运行

```bash
./icloud-hme-generator
```

### 运行示例输出

```
开始批量生成 5 个隐藏邮件地址...

[1/5] 正在生成... [成功] 成功: jute-panic.6p@icloud.com
[2/5] 正在生成... [成功] 成功: crafty.claque_3p@icloud.com
[3/5] 正在生成... [成功] 成功: diktat.tabla-3l@icloud.com
[4/5] 正在生成... [成功] 成功: blue-happy-7k@icloud.com
[5/5] 正在生成... [成功] 成功: green-cool-9n@icloud.com

==================================================
生成完成！
成功: 5 个
失败: 0 个
==================================================

成功生成的邮箱地址:
1. jute-panic.6p@icloud.com
2. crafty.claque_3p@icloud.com
3. diktat.tabla-3l@icloud.com
4. blue-happy-7k@icloud.com
5. green-cool-9n@icloud.com

结果已保存到: generated_emails.txt
```

### 查看生成的邮箱

```bash
cat generated_emails.txt
```

---

## [常见问题]

### Q1: 程序返回 401 或 403 错误

**原因**: Cookie 已过期或无效

**解决方案**:
1. 重新从浏览器获取最新的 Cookie
2. 确保在浏览器中能正常使用隐藏邮件功能
3. 检查 `dsid` 和 `client_id` 是否正确

### Q2: 程序返回 429 错误（Too Many Requests）

**原因**: 请求过于频繁，被 iCloud 限流

**解决方案**:
1. 增加 `delay_seconds` 的值（如设置为 5 或更高）
2. 减少 `count` 的值
3. 等待一段时间（如 10-30 分钟）后再试

### Q3: Cookie 多久会过期？

**答**: iCloud 的 Cookie 通常有效期为几小时到几天不等，具体取决于：
- 账号的安全设置
- 是否启用了双重认证
- 登录的设备和位置

**建议**: 如果程序报错，首先尝试更新 Cookie。

### Q4: 如何知道 Cookie 是否有效？

**方法 1**: 在浏览器中访问 iCloud.com，看是否需要重新登录

**方法 2**: 运行程序，如果返回认证错误，说明 Cookie 已失效

### Q5: 可以生成多少个邮箱？

**答**: 
- 技术上没有限制，但建议单次不超过 20 个
- iCloud 可能对账号的总邮箱数量有限制
- 建议设置合理的延迟，避免被限流

### Q6: 生成的邮箱地址是否立即可用？

**答**: 是的，生成后立即可用。你可以在 iCloud 设置中查看所有生成的隐藏邮件地址。

### Q7: 如何删除生成的邮箱地址？

**答**: 
1. 访问 https://www.icloud.com
2. 进入"账户设置"
3. 找到"隐藏我的邮件"
4. 在列表中找到要删除的地址，点击删除

### Q8: 程序提示"无法解析响应"

**原因**: API 返回格式变化或网络问题

**解决方案**:
1. 检查网络连接
2. 确认 `base_url` 是否正确
3. 查看程序输出的原始响应内容
4. 尝试更新 `client_build_number` 和 `client_mastering_number`

### Q9: 如何在 Windows 上运行？

**编译**:
```bash
go build -o icloud-hme-generator.exe main.go
```

**运行**:
```bash
icloud-hme-generator.exe
```

### Q10: 如何在 Linux 上运行？

**编译**:
```bash
go build -o icloud-hme-generator main.go
chmod +x icloud-hme-generator
```

**运行**:
```bash
./icloud-hme-generator
```

---

## [安全提示]

1. **不要分享配置文件**: `config.json` 包含你的认证信息，不要分享给他人
2. **不要提交到 Git**: 项目已配置 `.gitignore` 忽略 `config.json`
3. **定期更换密码**: 建议定期更换 Apple ID 密码以保护账号安全
4. **使用应用专用密码**: 如果启用了双重认证，建议使用应用专用密码

---

## [获取帮助]

如果遇到问题：

1. 查看本文档的"常见问题"部分
2. 检查程序输出的错误信息
3. 确认配置文件格式正确（可以使用 JSON 验证工具）
4. 尝试在浏览器中手动生成邮箱，确认功能可用

---

## [更新日志]

### v2.0.0 (2024-11-02)

- [√] 完整的邮箱管理功能（创建、查看、停用、删除、重新激活）
- [√] 美观的彩色命令行界面
- [√] 智能重试机制和错误处理
- [√] 实时进度显示
- [√] 批量操作支持
- [√] 完善的文档和配置示例

### v1.0.0 (2024-11-02)

- [√] 实现基本的批量生成功能
- [√] 支持配置文件
- [√] 支持 gzip 压缩响应
- [√] 支持自定义延迟
- [√] 支持结果输出到文件
- [√] 详细的进度显示和错误处理

