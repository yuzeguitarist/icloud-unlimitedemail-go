# iCloud 隐藏邮箱管理工具 v2.3.0 · 使用指南

## 1. 快速开始

### 1.1 准备环境
- macOS 12+/Linux/Windows（推荐使用 `zsh` 或 `bash`）
- Go 1.19 及以上版本（推荐 1.21+）
- 已安装 Git

### 1.2 克隆与构建
```bash
git clone https://github.com/yuzeguitarist/icloud-unlimitedemail-go.git
cd icloud-unlimitedemail-go
go build -o icloud-hme main.go
```

### 1.3 配置文件
```bash
cp config.json.example config.json
```
编辑 `config.json`，填入认证信息。详见「2. 配置说明」。

### 1.4 运行
```bash
./icloud-hme
```

程序启动后可使用数字或快捷键操作菜单，Mac 终端建议开启等宽字体（如 SF Mono）。

## 🎯 v2.3.0 新功能亮点

### 邮箱保存功能
- 自动保存生成的邮箱到文件
- 支持时间戳记录
- 可在程序设置中开启/关闭

### 开发者模式
- 隐藏的调试功能
- 包含邮箱评分算法测试
- 默认关闭，需在程序设置中开启

### 配置热重载增强
- 智能重试机制（最多3次）
- 详细的修复建议
- 安全退出保护

### 程序设置重构
- 统一的设置管理界面
- 包含邮箱质量、保存设置、开发者模式
- 更清晰的层级结构

## 2. 配置说明

`config.json` 示例（部分字段按需填写）：

```json
{
  "base_url": "https://pXXX-maildomainws.icloud.com/v1/hme/reserve",
  "client_build_number": "XXXX_BUILD_NUMBER",
  "client_mastering_number": "XXXX_BUILD_NUMBER",
  "client_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "dsid": "YOUR_DSID_HERE",
  "headers": {
    "Cookie": "完整的 iCloud Cookie",
    "User-Agent": "浏览器 UA，可直接复制"
  },
  "lang_code": "en-us",
  "count": 5,
  "delay_seconds": 2,
  "output_file": "generated_emails.txt"
}
```

> 建议保留 `/v1/hme/reserve` 作为基准路径。程序会自动替换为 `generate`、`list`、`deactivate`、`delete`、`reactivate` 等接口。

### 2.1 必填字段
| 字段 | 说明 | 获取方式 |
| --- | --- | --- |
| `base_url` | HME API 基准端点 | 从浏览器抓包复制 `reserve` 请求 URL |
| `client_build_number` / `client_mastering_number` | 客户端版本号 | 同步从 URL 查询参数复制 |
| `client_id` | 唯一标识 | `reserve` 请求 URL 中的 `clientId` |
| `dsid` | Apple 账号 DSID | `reserve` 请求 URL 中的 `dsid` |
| `headers.Cookie` | 登录凭据 | 浏览器开发者工具请求头中的完整 Cookie |

### 2.2 推荐实践
- 使用 **浏览器开发者工具** (Network) 手动生成一个邮箱并复制参数
- 定期更新 Cookie（通常几小时~几天会过期）
- 将 `config.json` 加入 `.gitignore`，避免误提交
- macOS 用户建议开启 iCloud 二步验证并使用应用专用密码

## 3. 常用操作

| 菜单项 | 快捷键 | 功能 |
| --- | --- | --- |
| 查看邮箱列表 | `1` / `l` / `list` | 显示所有隐藏邮箱及状态 |
| 创建新邮箱 | `2` / `c` / `create` | 生成并确认一个邮箱 |
| 停用邮箱 | `3` / `d` / `deactivate` | 批量选择后停用 |
| 批量创建 | `4` / `b` / `batch` | 按前缀批量生成，支持延迟 |
| 彻底删除 | `5` / `delete` | 永久删除已停用邮箱 |
| 重新激活 | `6` / `r` / `reactivate` | 恢复停用邮箱 |
| 退出 | `0` / `q` / `quit` / `exit` / `e` | 安全退出程序 |

### CLI 体验
- 彩色输出突出状态符号（绿色成功、红色失败、黄色警告、青色提示）
- 进度条自动根据节点使用红→黄→绿渐变
- Spinner 自动清理 goroutine，失败时会给出红色提示

## 4. 获取认证信息

1. 登录 [iCloud.com](https://www.icloud.com)，进入「账户设置 → 隐藏我的邮件」
2. 打开浏览器开发者工具，切换到 Network 面板
3. 手动生成一个隐藏邮箱，请求列表中找到 `reserve` 或 `generate`
4. 从请求 URL 中复制 `clientId`、`clientBuildNumber`、`clientMasteringNumber`、`dsid`
5. 在 Headers → Request Headers 中复制完整 `Cookie`
6. 将上述信息填入 `config.json`

## 5. 常见问题

| 问题 | 可能原因 | 解决方案 |
| --- | --- | --- |
| `401/403 Unauthorized` | Cookie 过期 | 重新获取 Cookie，确认 `client_id`/`dsid` 无误 |
| `429 Too Many Requests` | 请求过快被限流 | 提高 `delay_seconds`，降低 `count`，稍后重试 |
| `无法解析响应` | API 返回格式变化或网络异常 | 记录原始响应，检查 `base_url` 是否仍指向 `reserve`，重试或更新构建号 |
| CLI 输出乱码 | 终端未使用 UTF-8 | 切换 UTF-8 / 设置等宽字体，macOS 建议使用 SF Mono |

## 6. 安全与合规

- 不要提交 `config.json` 或 Cookie 至任何公共仓库
- iCloud Cookie 有时效性，失效后程序会提示认证失败
- 请遵守 Apple 服务条款，合理频率调用 API

## 7. 支持

- 查看更多文档：`docs/RELEASE_NOTES.md`
- 提交问题：<https://github.com/yuzeguitarist/icloud-unlimitedemail-go/issues>
- 主要维护者：[@yuzeguitarist](https://github.com/yuzeguitarist)

> macOS Terminal、iTerm2、Linux GNOME Terminal、Windows Terminal 均已验证体验一致。
